@{
    Layout = "_Layout";
}

<div id="ngTopicModule" ng-controller="ngTopicController" ng-init="ngOnInit()">
    <div class="col-lg-12">
        @*Topic title*@
        <div>
            <div class="form-group">
                <b class="topic-name">
                    <a href="javascript:void(0);">Topic title</a>
                </b>
            </div>
        </div>

        @*Top pagination*@
        <div class="row">
            <div class="col-sm-6 col-xs-4">
                <button class="btn btn-primary btn-reply" onclick="ngOnPostReplyClicked()">
                    <span class="fa fa-reply"></span>
                    <span>&nbsp;</span>
                    <b>Post reply</b>
                </button>
            </div>
            <div class="col-sm-6 col-xs-8">
                <nav aria-label="Page navigation" class="text-right">
                    <ul class="pagination">
                        <li>
                            <a href="#" aria-label="Previous">
                                <span aria-hidden="true">&laquo;</span>
                            </a>
                        </li>
                        <li><a href="#">1</a></li>
                        <li><a href="#">2</a></li>
                        <li><a href="#">3</a></li>
                        <li><a href="#">4</a></li>
                        <li><a href="#">5</a></li>
                        <li>
                            <a href="#" aria-label="Next">
                                <span aria-hidden="true">&raquo;</span>
                            </a>
                        </li>
                    </ul>
                </nav>
            </div>
        </div>

        @*Posts*@
        <div>
            <div class="form-group">
                <div class="box box-widget post">
                    <div class="box-body">
                        <div class="col-xs-12 visible-xs">
                            <div class="form-group text-center">
                                <img class="img img-responsive" ng-src="{{_topic.post.creator.photo}}" />
                            </div>

                            <div>
                                <a href="@Url.Action("Profile", "Home")">
                                    <b>{{_topic.post.creator.username}}</b>
                                </a>
                            </div>

                            @*User role in the system*@
                            <div class="user-role">
                                <b>{{_topic.post.creator.role}}</b>
                            </div>

                            @*User post count*@
                            <div class="user-post-count">
                                <b>Posts :</b>
                                <span>&nbsp;</span>
                                <span class="badge">{{_topic.post.creator.posts}}</span>
                            </div>

                            <div class="user-joined-date">
                                <b>Joined :</b>
                                <span>&nbsp;</span>
                                <span>{{_topic.post.creator.joinedTime}}</span>
                            </div>
                        </div>
                        <div class="col-md-10 col-sm-9 col-xs-12">
                            <div class="post-title">
                                <table class="table table-condensed">
                                    <tbody>
                                    <tr>
                                        <th class="icon-container">
                                            <span class="fa fa-file"></span>
                                        </th>
                                        <td>
                                            <b><a href="javascript:void(0)">{{_topic.post.title}}</a></b>
                                        </td>
                                    </tr>
                                    <tr>
                                        <th class="icon-container">
                                            <span class="fa fa-clock-o"></span>
                                        </th>
                                        <td>
                                            <span class="time">{{_topic.post.createdTime}}</span>
                                        </td>
                                    </tr>
                                    </tbody>
                                </table>
                            </div>
                            <div class="post-content">
                                <ng-bind-html ng-bind-html="_topic.post.content"></ng-bind-html>
                            </div>
                            <div>
                                <div class="pull-right">
                                    <button class="="></button>
                                </div>
                            </div>
                            <div class="post-signature">
                                <ng-bind-html ng-bind-html="_topic.post.creator.signature"></ng-bind-html>
                            </div>
                        </div>
                        <div class="col-md-2 col-sm-3 visible-sm">
                            <div class="form-group text-center">
                                <img class="img img-responsive" ng-src="{{_topic.post.creator.photo}}"/>
                            </div>

                            <div>
                                <a href="@Url.Action("Profile", "Home")">
                                    <b>{{_topic.post.creator.username}}</b>
                                </a>
                            </div>

                            @*User role in the system*@
                            <div class="user-role">
                                <b>{{_topic.post.creator.role}}</b>
                            </div>

                            @*User post count*@
                            <div class="user-post-count">
                                <b>Posts :</b>
                                <span>&nbsp;</span>
                                <span class="badge">{{_topic.post.creator.posts}}</span>
                            </div>

                            <div class="user-joined-date">
                                <b>Joined :</b>
                                <span>&nbsp;</span>
                                <span>{{_topic.post.creator.joinedTime}}</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        @*Replies*@
        <div ng-repeat="reply in _topic.post.replies">
            <div class="form-group">
                <div class="box box-widget post">
                    <div class="box-body">
                        <div class="col-xs-12 visible-xs">
                            <div class="form-group text-center">
                                <img class="img img-responsive" ng-src="{{reply.creator.photo}}" />
                            </div>

                            <div>
                                <a href="@Url.Action("Profile", "Home")">
                                    <b>{{reply.creator.username}}</b>
                                </a>
                            </div>

                            @*User role in the system*@
                            <div class="user-role">
                                {{reply.creator.role}}
                            </div>

                            @*User post count*@
                            <div class="user-post-count">
                                <b>Posts:</b>
                                <span>&nbsp;</span>
                                <span class="badge">{{reply.creator.posts}}</span>
                            </div>

                            <div class="user-joined-date">
                                <b>Joined:</b>
                                <span>&nbsp;</span>
                                <span>{{reply.creator.joinedTime}}</span>
                            </div>
                        </div>
                        <div class="col-md-10 col-sm-9 col-xs-12">
                            <div class="post-title">
                                <table class="table table-condensed">
                                    <tbody>
                                        <tr>
                                            <th class="icon-container">
                                                <span class="fa fa-reply"></span>
                                            </th>
                                            <td>
                                                <b><a href="javascript:void(0)">Re: {{_topic.post.title}}</a></b>
                                            </td>
                                        </tr>
                                        <tr>
                                            <th class="icon-container">
                                                <span class="fa fa-clock-o"></span>
                                            </th>
                                            <td>
                                                <span class="time">{{reply.createdTime}}</span>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            <div class="post-content">
                                <ng-bind-html ng-bind-html="reply.content"></ng-bind-html>
                            </div>
                            <div class="post-signature">
                                <ng-bind-html ng-bind-html="reply.creator.signature"></ng-bind-html>
                            </div>
                        </div>
                        <div class="col-md-2 col-sm-3 hidden-xs">
                            <div class="form-group text-center">
                                <img class="img img-responsive" ng-src="{{reply.creator.photo}}" />
                            </div>

                            <div>
                                <a href="@Url.Action("Profile", "Home")">
                                    <b>{{reply.creator.username}}</b>
                                </a>
                            </div>

                            @*User role in the system*@
                            <div class="user-role">
                                {{reply.creator.role}}
                            </div>

                            @*User post count*@
                            <div class="user-post-count">
                                <b>Posts:</b>
                                <span>&nbsp;</span>
                                <span class="badge">{{reply.creator.posts}}</span>
                            </div>

                            <div class="user-joined-date">
                                <b>Joined:</b>
                                <span>&nbsp;</span>
                                <span>{{reply.creator.joinedTime}}</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        @*Bottom pagination*@
        <div class="row">
            <div class="col-lg-12">
                <nav aria-label="Page navigation" class="text-right">
                    <ul class="pagination">
                        <li>
                            <a href="#" aria-label="Previous">
                                <span aria-hidden="true">&laquo;</span>
                            </a>
                        </li>
                        <li><a href="#">1</a></li>
                        <li><a href="#">2</a></li>
                        <li><a href="#">3</a></li>
                        <li><a href="#">4</a></li>
                        <li><a href="#">5</a></li>
                        <li>
                            <a href="#" aria-label="Next">
                                <span aria-hidden="true">&raquo;</span>
                            </a>
                        </li>
                    </ul>
                </nav>
            </div>
        </div>

        @*Quick reply*@
        <div class="box box-default">
            <div class="box-header">
                <h3 class="box-title">Quick reply</h3>
                <div class="box-tools pull-right">
                    <button type="button" class="btn btn-box-tool" data-widget="collapse">
                        <i class="fa fa-minus"></i>
                    </button>
                </div>
            </div>
            <div id="id-post-reply-container"
                 class="box-body collapse">
                <textarea id="id-post-reply" class="tiny-mce" rows="10"></textarea>
            </div>
        </div>
    </div>
</div>

<script src="https://cloud.tinymce.com/stable/tinymce.min.js?apiKey=qsybv466hz6ltwlqqzjbuqz8ewukrpszean3zok1r22k8trp"></script>
<script>
    tinymce.init({
        selector: 'textarea.tiny-mce',
        resize: false
    });

    ngOnPostReplyClicked = function () {
        $([document.documentElement, document.body]).animate({
            scrollTop: $("#id-post-reply-container").offset().top
        }, 300);
    };
</script>


<script>

    $(function () {
        var ngTopicModule = angular.module('ngTopicModule', ['ngSanitize']);
        ngTopicModule.controller('ngTopicController',
            function ($scope, $topic) {

                $scope._topic = {};

                $scope.ngOnInit = function () {

                    $topic
                        .loadTopic()
                        .then(function (loadTopicResult) {
                            $scope._topic = loadTopicResult;
                            console.log(loadTopicResult);
                        });
                }
            });

        ngTopicModule.service('$topic',
            function ($http) {

                this.loadTopic = function () {
                    return $http.get('/data/topic.json')
                        .then(function (loadTopicResponse) {
                            return loadTopicResponse.data;
                        });
                }
            });

        angular.bootstrap(document, ['ngTopicModule']);
    })

</script>